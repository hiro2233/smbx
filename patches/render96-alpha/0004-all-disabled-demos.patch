From 2679911cf4a861f800000daaf37401092a371bef Mon Sep 17 00:00:00 2001
From: "Hiroshi Takey F. (hiro2233)" <htakey@gmail.com>
Date: Tue, 16 Feb 2021 03:48:27 -0400
Subject: [PATCH 4/5] all: disabled demos.

---
 Makefile                     |  6 +++---
 assets.json                  | 10 +---------
 src/game/game_init.c         |  4 ++--
 src/menu/level_select_menu.c | 12 ++++++------
 4 files changed, 12 insertions(+), 20 deletions(-)

diff --git a/Makefile b/Makefile
index c95114aa..5b11e021 100644
--- a/Makefile
+++ b/Makefile
@@ -307,7 +307,7 @@ CXX_FILES := $(foreach dir,$(SRC_DIRS),$(wildcard $(dir)/*.cpp))
 S_FILES := $(foreach dir,$(ASM_DIRS),$(wildcard $(dir)/*.s))
 GODDARD_C_FILES := $(foreach dir,$(GODDARD_SRC_DIRS),$(wildcard $(dir)/*.c))
 
-GENERATED_C_FILES := $(BUILD_DIR)/assets/mario_anim_data.c $(BUILD_DIR)/assets/luigi_anim_data.c $(BUILD_DIR)/assets/demo_data.c
+GENERATED_C_FILES := $(BUILD_DIR)/assets/mario_anim_data.c $(BUILD_DIR)/assets/luigi_anim_data.c
 
 ULTRA_C_FILES := \
   alBnkfNew.c \
@@ -746,8 +746,8 @@ $(BUILD_DIR)/assets/mario_anim_data.c: $(wildcard assets/anims/*.inc.c)
 $(BUILD_DIR)/assets/luigi_anim_data.c: $(wildcard assets/luigi_anims/*.inc.c)
 	$(PYTHON) tools/luigi_anims_converter.py > $@
 
-$(BUILD_DIR)/assets/demo_data.c: assets/demo_data.json $(wildcard assets/demos/*.bin)
-	$(PYTHON) tools/demo_data_converter.py assets/demo_data.json $(VERSION_CFLAGS) > $@
+#$(BUILD_DIR)/assets/demo_data.c: assets/demo_data.json $(wildcard assets/demos/*.bin)
+#	$(PYTHON) tools/demo_data_converter.py assets/demo_data.json $(VERSION_CFLAGS) > $@
 
 # Source code
 $(BUILD_DIR)/levels/%/leveldata.o: OPT_FLAGS := -g
diff --git a/assets.json b/assets.json
index 0bd4ee4c..c729f770 100644
--- a/assets.json
+++ b/assets.json
@@ -1,4 +1,4 @@
-{
+    {
 "@comment": "This file was generated by tools/gen_asset_list.cpp. When renaming a file, either change its name in this file directly, or regenerate this file using that script.",
 
 "@sound ctl eu": [97856,{"eu":[5626032]}],
@@ -528,14 +528,6 @@
 "actors/yoshi_egg/yoshi_egg_5_unused.rgba16.png": [32,32,2048,{"jp":[1215456,32696],"us":[1222624,32696],"eu":[1094592,32696],"sh":[1071104,32696]}],
 "actors/yoshi_egg/yoshi_egg_6_unused.rgba16.png": [32,32,2048,{"jp":[1215456,34744],"us":[1222624,34744],"eu":[1094592,34744],"sh":[1071104,34744]}],
 "actors/yoshi_egg/yoshi_egg_7_unused.rgba16.png": [32,32,2048,{"jp":[1215456,36792],"us":[1222624,36792],"eu":[1094592,36792],"sh":[1071104,36792]}],
-"assets/demos/bbh.bin": [988,{"jp":[5733368],"us":[5741664],"eu":[5620584],"sh":[5589632]}],
-"assets/demos/bitdw.bin": [1412,{"us":[5747100],"sh":[5595068]}],
-"assets/demos/ccm.bin": [1320,{"jp":[5734356],"us":[5742652],"eu":[5621572],"sh":[5590620]}],
-"assets/demos/hmc.bin": [980,{"jp":[5735676],"us":[5743972],"eu":[5622892],"sh":[5591940]}],
-"assets/demos/jrb.bin": [620,{"jp":[5736656],"us":[5744952],"eu":[5623872],"sh":[5592920]}],
-"assets/demos/pss.bin": [748,{"jp":[5737948],"us":[5746244],"eu":[5625164],"sh":[5594212]}],
-"assets/demos/unused.bin": [108,{"jp":[5738696],"us":[5746992],"eu":[5625912],"sh":[5594960]}],
-"assets/demos/wf.bin": [672,{"jp":[5737276],"us":[5745572],"eu":[5624492],"sh":[5593540]}],
 "levels/bbh/0.rgba16.png": [32,64,4096,{"jp":[3604960,0],"us":[3611712,0],"eu":[3485312,0],"sh":[3459680,0]}],
 "levels/bbh/1.rgba16.png": [32,32,2048,{"jp":[3604960,4096],"us":[3611712,4096],"eu":[3485312,4096],"sh":[3459680,4096]}],
 "levels/bbh/2.rgba16.png": [32,32,2048,{"jp":[3604960,6144],"us":[3611712,6144],"eu":[3485312,6144],"sh":[3459680,6144]}],
diff --git a/src/game/game_init.c b/src/game/game_init.c
index bc7f3b1f..26553fb8 100644
--- a/src/game/game_init.c
+++ b/src/game/game_init.c
@@ -457,7 +457,7 @@ void read_controller_inputs(void) {
         osRecvMesg(&gSIEventMesgQueue, &D_80339BEC, OS_MESG_BLOCK);
         osContGetReadData(&gControllerPads[0]);
     }
-    run_demo_inputs();
+    //run_demo_inputs();
 
     for (i = 0; i < 2; i++) {
         struct Controller *controller = &gControllers[i];
@@ -554,7 +554,7 @@ void setup_game_memory(void) {
     func_80278A78(&Data_LuigiAnims, gLuigiAnims, D_80339CF0);
     D_80339CF4 = main_pool_alloc(2048, MEMORY_POOL_LEFT);
     set_segment_base_addr(24, (void *) D_80339CF4);
-    func_80278A78(&gDemo, gDemoInputs, D_80339CF4);
+    //func_80278A78(&gDemo, gDemoInputs, D_80339CF4);
     load_segment(0x10, _entrySegmentRomStart, _entrySegmentRomEnd, MEMORY_POOL_LEFT);
     load_segment_decompress(2, _segment2_mio0SegmentRomStart, _segment2_mio0SegmentRomEnd);
 }
diff --git a/src/menu/level_select_menu.c b/src/menu/level_select_menu.c
index 667d59e7..a95ed6ad 100644
--- a/src/menu/level_select_menu.c
+++ b/src/menu/level_select_menu.c
@@ -49,19 +49,19 @@ int run_press_start_demo_timer(s32 timer) {
 //D_U_801A7C34 == 1;
                 D_U_801A7C34 = 1;
                 // start the Mario demo animation for the demo list.
-                load_patchable_table(&gDemo, gDemoInputListID);
+                //load_patchable_table(&gDemo, gDemoInputListID);
 
                 // if the next demo sequence ID is the count limit, reset it back to
                 // the first sequence.
-                if (++gDemoInputListID == gDemo.animDmaTable->count) {
+                //if (++gDemoInputListID == gDemo.animDmaTable->count) {
                     gDemoInputListID = 0;
 
-                }
+                //}
 
                 // add 1 (+4) to the pointer to skip the demoID.
-                gCurrDemoInput = ((struct DemoInput *) gDemo.targetAnim) + 1;
-                timer = (s8)((struct DemoInput *) gDemo.targetAnim)->timer;
-                gCurrSaveFileNum = 1;
+                //gCurrDemoInput = ((struct DemoInput *) gDemo.targetAnim) + 1;
+                //timer = (s8)((struct DemoInput *) gDemo.targetAnim)->timer;
+                //gCurrSaveFileNum = 1;
                 gCurrActNum = 1;
             }
         } else { // activity was detected, so reset the demo countdown.
-- 
2.17.3

